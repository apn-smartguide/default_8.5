if(typeof SMARTGUIDES==="undefined"){SMARTGUIDES={}}$("form[id^='smartguide_']").each(function(){var smartletCode=$(this).attr("id").replace("smartguide_","");var $form=$(this);SMARTGUIDES[smartletCode]={fm:$("form#smartguide_"+smartletCode),posted:false,dataTableInstances:{},addScrollLock:function(){var $body=$("body");var curScrollLockCount=0;if($body.attr("scrolllock-count")){curScrollLockCount=parseInt($body.attr("scrolllock-count"))}curScrollLockCount=curScrollLockCount+1;$body.attr("scrolllock-count",curScrollLockCount);if(!$body.hasClass("modal-open")){$body.addClass("modal-open")}},removeScrollLock:function(){var $body=$("body");var curScrollLockCount=0;if($body.attr("scrolllock-count")){curScrollLockCount=parseInt($body.attr("scrolllock-count"))}if(parseInt(curScrollLockCount)==1){$body.removeClass("modal-open");$body.removeAttr("scrolllock-count")}else{if(parseInt(curScrollLockCount)>1){curScrollLockCount=curScrollLockCount-1;$body.attr("scrolllock-count",curScrollLockCount)}}},init:function(){$(document).ready(function(){var r=SMARTGUIDES[smartletCode];$('[data-toggle="tooltip"]').tooltip();$(".modal-dialog",r.fm).draggable({handle:".modal-header"});$('button, input[type="button"], input[type="submit"], input[type="image"]',r.fm).click(r._baseDoubleClickHandler);r._bindOrTriggerSmartletAndPageEvent();customJS.init(r);r.bindEvents();for(var i=0;i<Object.keys(r.dataTableInstances).length;i++){r.dataTableInstances[Object.keys(r.dataTableInstances)[i]].rows().nodes().page.len(10).draw(false)}})},_baseDoubleClickHandler:function(e){if(!$(this).hasClass("always-enabled")){e.preventDefault();var r=SMARTGUIDES[smartletCode];if(!r.posted){for(var i=0;i<Object.keys(r.dataTableInstances).length;i++){r.dataTableInstances[Object.keys(r.dataTableInstances)[i]].rows().nodes().page.len(-1).draw(false)}$(this).prop("disabled",true);r.posted=true;r.fm.append($("<input/>",{type:"hidden",name:this.name,value:this.value})).submit()}else{if(console){console.log("Waiting for first post to complete...")}}}return false},_doubleClickHandler:function(e){if(!$(this).hasClass("always-enabled")){e.preventDefault();var r=SMARTGUIDES[smartletCode];if(!r.posted){for(var i=0;i<Object.keys(r.dataTableInstances).length;i++){r.dataTableInstances[Object.keys(r.dataTableInstances)[i]].rows().nodes().page.len(-1).draw(false)}$(this).prop("disabled",true);r.posted=true;r.fm.submit()}else{if(console){console.log("Waiting for first post to complete...")}}}return false},_bindOrTriggerSmartletAndPageEvent:function(){var r=SMARTGUIDES[smartletCode];var $body=$("body");if(typeof smartletfields.smartlet!=="undefined"){var events=smartletfields.smartlet.events;if(events!==null){var r=SMARTGUIDES[smartletCode];var smartlet=r._createSmartletContext(null,null,null);$body.data("_smartlet",smartlet);for(var event in events){var jqEvent=event.toLowerCase();var handler=r._createEventHandler(events[event].client);if(jqEvent.indexOf("event_on_init_smartlet")==0){$body.bind("smartlet:init",handler)}else{if(jqEvent.indexOf("event_on_enter_page")==0){$body.bind("smartlet:page_enter",handler)}else{if(jqEvent.indexOf("event_on_exit_page")==0){$body.bind("smartlet:page_exit",handler);$(window).unbind("beforeunload").bind("beforeunload",function(e){$body.triggerHandler("smartlet:page_exit")})}}}}}}if(typeof smartletfields.page!=="undefined"){var events=smartletfields.page.events;if(events!==null){if(typeof $body.data("_smartlet")=="undefined"){var r=SMARTGUIDES[smartletCode];var smartlet=r._createSmartletContext(null,null,null);$body.data("_smartlet",smartlet)}for(var event in events){if(!events[event].server){var jqEvent=event.toLowerCase();var handler=r._createEventHandler(events[event].client);if(jqEvent.indexOf("onpageinit")==0){$body.bind("page:init",handler)}else{if(jqEvent.indexOf("onpagerender")==0){$body.bind("page:render",handler)}}}}}}$body.triggerHandler("smartlet:init");$body.triggerHandler("page:init");$body.triggerHandler("smartlet:page_enter");$body.triggerHandler("page:render")},bindEvents:function(ajaxUpdates){var r=SMARTGUIDES[smartletCode];if(typeof $.fn.dataTable!=="undefined"){$.fn.dataTable.ext.order["dom-text"]=function(settings,col){return this.api().column(col,{order:"index"}).nodes().map(function(td,i){if($("input[type=radio]",td).length>0){return $("input:checked",td).val()}if($("input[type=checkbox]",td).length>0){return $("input[type=checkbox]:checked",td).val()}if($("input",td).length>0){return $("input",td).val()}if($("select",td).length>0){return $("select",td).val()}return $.trim($(td).text())})};$.fn.dataTable.ext.search.length=0;$.fn.dataTable.ext.search.push(function(settings,data,dataIndex,rowData,counter){var filter=$(".dataTables_filter input").val();if(filter===""){return true}for(var i=0;i<data.length;i++){var text="";try{var parentDiv=$(data[i]);$("input[type=text]",parentDiv).each(function(){text+=" | "+$("input[name='"+this.name+"']").val()});$("input[type=checkbox], input[type=radio]",parentDiv).each(function(){$("input[name='"+$(this).attr("name")+"']").each(function(){if(typeof(this.value)!=="undefined"&&$(this).is(":checked")){text+=" | "+this.value}})});if(text===""){text=$(data[i]).text()}if(text===""){text=data[i]}}catch(e){text=data[i]}if(text.toLowerCase().indexOf(filter.toLowerCase())>-1){return true}}return false})}$("button.repeat_prepare_add_btn",$form).unbind("click").bind("click",function(){var level=$(this).attr("data-level");$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove();var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'" />';$(this).after(newinput);r.ajaxProcess(this,null,true,function(){var modal=$(".crud-modal"+level,$form);$(".alert",modal).html("").hide();modal.data("data",$("input,textarea,select",modal).serialize());modal.modal({backdrop:"static",keyboard:false});$('[data-toggle="tooltip"]',modal).tooltip();modal.on("hide.bs.modal",function(e){var cancelBtn=$("button.btn.repeat_cancel_add_btn",this);var newinput='<input type="hidden" name="'+cancelBtn[0].id+'" id="'+cancelBtn[0].id+'" value="'+cancelBtn[0].id+'" />';$(cancelBtn[0]).after(newinput);r.ajaxProcess(cancelBtn[0],null,true)});$(".crud-modal"+level+" .modal-content",$form).draggable({handle:".modal-header"});$(".hide-from-add-view",".crud-modal"+level).parent().hide();$("input:visible:first",".crud-modal"+level).focus()})});$("button.repeat_save_add_btn",$form).unbind("click").bind("click",function(e){var level=$(this).attr("data-level");var $this=$(this);var tableDiv=$this.closest("div.repeat");var f=tableDiv.triggerHandler("repeat:addinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}$(".crud-modal"+level,$form).off("hide.bs.modal");var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'"/>';$this.before(newinput);$this.prop("disabled",true);r.ajaxProcess(this,null,true,function(updatedEles){$("div#alerts",$form).hide();var hasModal=false;if(updatedEles&&updatedEles.length>0){for(var i=0;i<updatedEles.length;i++){if(updatedEles[i].hasClass("modal-body")){hasModal=true}}}if(!hasModal){$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove();$("div#alerts",$form).show()}$this.prop("disabled",false);$(".hide-from-add-view",".crud-modal"+level).parent().hide()})});$("button.repeat_cancel_add_btn",$form).unbind("click").bind("click",function(){var level=$(this).attr("data-level");var modal=$(".crud-modal"+level,$form);if(modal.data("data")!=$("input,textarea,select",modal).serialize()){if(confirm(crudModalsTranslations.discardChanges)){return}}modal.off("hide.bs.modal");var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'" />';$(this).after(newinput);r.ajaxProcess(this,null,true);$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove()});$(".repeat_prepare_edit_btn",$form).unbind("click").bind("click",function(){var level=$(this).attr("data-level");$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove();var rpt=$(this).attr("data-repeat-index-name");var count=$(this).attr("data-instance-pos");$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));$("#"+this.id.replace("[","\\[").replace("]","\\]")).after('<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />');r.ajaxProcess(this,"input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]",true,function(){var modal=$(".crud-modal"+level,$form);$(".alert",modal).html("").hide();modal.data("data",$("input,textarea,select",modal).serialize());$(".crud-modal"+level,$form).modal({backdrop:"static",keyboard:false});$('[data-toggle="tooltip"]',modal).tooltip();$(".crud-modal"+level,$form).on("hide.bs.modal",function(e){var cancelBtn=$("button.btn.repeat_cancel_edit_btn",this);var newinput='<input type="hidden" name="'+cancelBtn[0].id+'" id="'+cancelBtn[0].id+'" value="'+cancelBtn[0].id+'" />';$(cancelBtn[0]).after(newinput);r.ajaxProcess(cancelBtn[0],null,true)});$(".crud-modal"+level+" .modal-content",$form).draggable({handle:".modal-header"});$(".hide-from-edit-view",".crud-modal"+level).parent().hide();$("input:visible:first",".crud-modal"+level).focus()})});$("button.repeat_cancel_edit_btn",$form).unbind("click").bind("click",function(){var level=$(this).attr("data-level");var modal=$(".crud-modal"+level,$form);if(modal.data("data")!=$("input,textarea,select",modal).serialize()){if(confirm(crudModalsTranslations.discardChanges)){return}}modal.off("hide.bs.modal");var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'" />';$(this).after(newinput);r.ajaxProcess(this,null,true,function(){$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove()})});$("button.repeat_save_edit_btn",$form).unbind("click").bind("click",function(e){var level=$(this).attr("data-level");var $this=$(this);var tableDiv=$this.closest("div.repeat");var f=tableDiv.triggerHandler("repeat:updateinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}$(".crud-modal"+level,$form).off("hide.bs.modal");var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'" />';$this.before(newinput);if($(".paginationInfo",".bootpag").length>0){var beforeUpdate=$("#"+tableDiv.attr("id").replace("[","\\[").replace("]","\\]")+" > .bootpag").html();$this.after('<div tableID="'+tableDiv.attr("id")+'" style="display:none;" id="beforeUpdate">'+beforeUpdate+"</div>")}var btn=$this;btn.prop("disabled",true);r.ajaxProcess(this,null,true,function(updatedEles){$("div#alerts",$form).hide();var hasModal=false;if(updatedEles&&updatedEles.length>0){for(var i=0;i<updatedEles.length;i++){if(updatedEles[i].hasClass("modal-body")){hasModal=true}}}if(!hasModal){$(".crud-modal"+level,$form).modal("hide").data("modal",null).remove();$("div#alerts",$form).show()}btn.prop("disabled",false);$(".hide-from-edit-view",".crud-modal"+level).parent().hide()})});$(".repeat_del_btn").unbind("click").bind("click",function(e){if(!confirm(crudModalsTranslations.deleteRow)){return false}var $this=$(this);var tableDiv=$this.closest("div.repeat");var f=tableDiv.triggerHandler("repeat:deleteinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}var rpt=$this.attr("data-repeat-index-name");var count=$this.attr("data-instance-pos");$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));$("#"+this.id.replace("[","\\[").replace("]","\\]")).after('<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />');r.ajaxProcess(this,"input[name="+rpt+"]",true)});$(".repeat_table_append_btn, .repeat_block_append_btn").unbind("click").bind("click",function(e){var $this=$(this);var isRepeatTable=$this.hasClass("repeat_table_append_btn");var tableDiv=$this.closest(isRepeatTable?"div.repeat":"div.repeatblock");var f=tableDiv.triggerHandler("repeat:addinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}var newinput='<input type="hidden" name="'+this.id+'" id="'+this.id+'" value="'+this.id+'" />';$this.after(newinput);r.ajaxProcess(this,null,true);return false});$(".repeat_table_add_btn, .repeat_block_add_btn").unbind("click").bind("click",function(e){var $this=$(this);var isRepeatTable=$this.hasClass("repeat_table_add_btn");var tableDiv=$this.closest(isRepeatTable?"div.repeat":"div.repeatblock");var f=tableDiv.triggerHandler("repeat:addinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}var thisId=this.id.replace("[","\\[").replace("]","\\]");var classes=$("#"+thisId).attr("class");var rptandid=classes.substring(classes.lastIndexOf(" "));var rpt=rptandid.substring(0,rptandid.lastIndexOf("_"));var count=rptandid.substring(rptandid.lastIndexOf("_")+1);$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));var newinput='<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />';$this.after(newinput);r.ajaxProcess(this,null,true)});$(".repeat_table_del_btn, .repeat_block_del_btn").unbind("click").bind("click",function(e){var $this=$(this);var isRepeatTable=$this.hasClass("repeat_table_del_btn");var tableDiv=$this.closest(isRepeatTable?"div.repeat":"div.repeatblock");var f=tableDiv.triggerHandler("repeat:deleteinstance");if(typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}var thisId=this.id.replace("[","\\[").replace("]","\\]");var classes=$("#"+thisId).attr("class");var rptandid=classes.substring(classes.lastIndexOf(" "));var rpt=rptandid.substring(0,rptandid.lastIndexOf("_"));var count=rptandid.substring(rptandid.lastIndexOf("_")+1);$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));$("#"+thisId).after('<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />');r.ajaxProcess(this,"input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]",true)});$(".repeat_table_moveup_btn, .repeat_block_moveup_btn, .repeat_moveup_btn").unbind("click").bind("click",function(e){var $this=$(this);var isRepeatTable=$this.hasClass("repeat_table_moveup_btn");var tableDiv=$this.closest(isRepeatTable?"div.repeat":"div.repeatblock");var thisId=this.id.replace("[","\\[").replace("]","\\]");var classes=$("#"+thisId).attr("class");var rptandid=classes.substring(classes.lastIndexOf(" "));var rpt=rptandid.substring(0,rptandid.lastIndexOf("_"));var count=rptandid.substring(rptandid.lastIndexOf("_")+1);$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));var newinput='<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />';$this.after(newinput);r.ajaxProcess(this,null,true)});$(".repeat_table_movedown_btn, .repeat_block_movedown_btn, .repeat_movedown_btn").unbind("click").bind("click",function(e){var $this=$(this);var isRepeatTable=$this.hasClass("repeat_table_movedown_btn");var tableDiv=$this.closest(isRepeatTable?"div.repeat":"div.repeatblock");var thisId=this.id.replace("[","\\[").replace("]","\\]");var classes=$("#"+thisId).attr("class");var rptandid=classes.substring(classes.lastIndexOf(" "));var rpt=rptandid.substring(0,rptandid.lastIndexOf("_"));var count=rptandid.substring(rptandid.lastIndexOf("_")+1);$("input[name="+rpt.replace("[","\\[").replace("]","\\]")+"]").val(count);var basename=this.id.substring(0,this.id.lastIndexOf("_"));var newinput='<input type="hidden" name="'+basename+'" id="'+basename+'" value="'+basename+'" />';$this.after(newinput);r.ajaxProcess(this,null,true)});$(".hide-from-list-view",r.fm).each(function(){var skipElement=false;$(".modal").each(function(){var classes=$(this).attr("class");if(classes.indexOf("crud-modal")>-1){skipElement=true;return}});if(skipElement){return}if($(this).closest("td").length>0){$(this).closest("td").remove()}else{$(this).parent().remove()}});r.dataTableInstances={};$("div.repeat table").each(function(index,elmt){var table=$(this);var repeatDivId=table.closest("div.repeat").prop("id");if($("#"+repeatDivId).hasClass("repeatblock")){return true}var r=SMARTGUIDES[smartletCode];var fm=r.fm;var loadTable=function(){$("#loader").show();table.fadeTo(0,0.2);fm.ajaxSubmit({crossDomain:false,type:"post",iframe:false,data:{isAjax:"true"},success:function(data){try{response=data;var responseDiv=$("div#sgControls",response);var repeatDiv=$("div#"+repeatDivId,responseDiv);var paginationInfo=$("span.paginationInfo",repeatDiv);var newTable=$("table.hasPagination",repeatDiv);table.empty();table.html(newTable.html());$("span.paginationInfo",table.parent()).html(paginationInfo.html());$.each(newTable.prop("attributes"),function(){table.attr(this.name,this.value)});r.bindEvents([repeatDiv])}catch(e){if(console){console.log(e.stack)}}$("#loader").hide();table.fadeTo(0,1)},error:function(XMLHttpRequest,textStatus,errorThrown){if(console){console.log("Error: print XMLHttpRequest textStatus and errorThrown");console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown)}$("#loader").hide();table.fadeTo(0,1)}})};var refreshTable=function(){var currentPage=1;var totalPage=parseInt(table.attr("data-total-pages"));if($("input.repeatCurrentPage",table).length>0){currentPage=parseInt($("input.repeatCurrentPage",table).val())+1}$(elmt).closest("div.bootpag").bootpag({total:totalPage,page:currentPage,maxVisible:5,href:"#pro-page-{{number}}",leaps:false,wrapClass:"pagination",next:">",prev:"<"}).off("page").on("page",function(event,num){$("input.repeatCurrentPage",table).val(num-1);loadTable()})};$(".sortBtn",this).off("click").on("click",function(){var fieldId=$(this).attr("data-field-id");var currentSort=$(this).attr("data-sort");var sort="+"+fieldId;if(currentSort=="asc"){sort="-"+fieldId}$("input.repeatSort",table).val(sort);$("input.repeatCurrentPage",table).val("0");$(this).css("color","black");loadTable()});$("select.pageSize",$(this).closest("div.repeat")).off("change").on("change",function(){$("input.repeatCurrentPage",table).val("0");loadTable()});$(".searchBtn",$(this).closest("div.repeat")).off("click").on("click",function(){$("input.repeatCurrentPage",table).val("0");loadTable();refreshTable();return false});if($(elmt).hasClass("hasPagination")){table.addClass("table responsive table-striped table-hover no-footer dtr-inline collapsed");table.css("margin-bottom",0);refreshTable()}else{try{if(!$.fn.dataTable.isDataTable("#"+$(elmt).attr("id"))){var gridOption={};var repeatDiv=$(this).parent().parent();if(repeatDiv.hasClass("hide-search")){gridOption["hide-search"]=true}if(repeatDiv.hasClass("hide-pagination")){gridOption["hide-pagination"]=true}if(repeatDiv.hasClass("grid-view")){gridOption["standard-search"]=true}if(repeatDiv.hasClass("selectable")){gridOption.selectable=true}var dtOptions={stateSave:true,stateSaveCallback:function(settings,data){var divId=$(settings.oInstance).closest("div.repeat").attr("id");localStorage.setItem("DataTables_"+divId,JSON.stringify(data))},stateLoadCallback:function(settings){var divId=$(settings.oInstance).closest("div.repeat").attr("id");return JSON.parse(localStorage.getItem("DataTables_"+divId))},initComplete:function(settings,json){if(!settings.oFeatures.bPaginate){$(".dataTables_info",$(this).closest(".dataTables_wrapper")).hide()}},lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],pageLength:10,language:dataTableTranslations,autoWidth:false,columnDefs:[{orderDataType:"dom-text",targets:"_all",type:"string"},{targets:"repeatbutton",orderable:false,width:"50px"}]};if(gridOption["hide-search"]){dtOptions.searching=false}if(gridOption["hide-pagination"]){dtOptions.paging=false}if(gridOption["standard-search"]&&!gridOption.selectable){dtOptions.columnDefs=[{targets:"repeatbutton",orderable:false,width:"50px"}]}if(gridOption.selectable){dtOptions.order=[[0,"desc"]]}if(repeatDiv.hasClass("hide-sort")){dtOptions.ordering=false}if(!repeatDiv.hasClass("grid-view")){dtOptions.responsive={details:{type:"inline",display:function(row,update,render){var $rowNode=$(row.node());var table=$rowNode.closest("table");var theader=$("thead",table);if((!update&&row.child.isShown())||!row.responsive.hasHidden()){$rowNode.removeClass("parent");$rowNode.css("border","");row.child(false);$("th",theader).css({display:"table-cell"});$("td",$rowNode).show().css("display","table-cell");$("label.responsive",$rowNode).remove();return false}else{$rowNode.addClass("parent");$rowNode.css("border","1px solid #666666");$("th",theader).css({display:"inline-block"});$("td",$rowNode).each(function(index){if($("label.responsive",this).length==0){$(this).prepend("<label class='responsive'>"+$("th:eq("+index+") > span",theader).text()+"</label>")}}).show().css({display:"inline-block"});return true}}}}}var otable=$(elmt).show().DataTable(dtOptions);otable.on("draw.dt",function(){r.bindEvents()});r.dataTableInstances[$(repeatDiv).attr("id")]=otable}else{var repeatDiv=$(this).parent().parent();var otable=$(elmt).DataTable();r.dataTableInstances[$(repeatDiv).attr("id")]=otable}}catch(e){if(console){console.log(e.stack)}}}});$("input[type=text][data-eventtarget],input[type=password][data-eventtarget],textarea[data-eventtarget]").unbind("keyup paste",r.bindThis).bind("keyup paste",r.bindThis);$("input[type=text][data-eventtarget],input[type=password][data-eventtarget],textarea[data-eventtarget]").unbind("blur",r.bindThisAllowSelfRefresh).bind("blur",r.bindThisAllowSelfRefresh);$("input[type=checkbox][data-eventtarget],input[type=radio][data-eventtarget]").unbind("change",r.bindThisAllowSelfRefresh).bind("change",r.bindThisAllowSelfRefresh);$("input[type=image][data-eventtarget]").unbind("click",r.bindThis).bind("click",r.bindThis);$("select:has(option[data-eventtarget])").unbind("change",r.bindThisOption).bind("change",r.bindThisOption);$(".modal-close").unbind("click").bind("click",function(e){var modal=$(this).parent().parent().parent().parent();r.ajaxProcess(modal,null,true,function(){r.removeScrollLock()});modal.modal("hide")});r.bindSelectBoxRadios();var updatedRepeatIds=[];for(var key in smartletfields){var field=smartletfields[key];var events=field.events;if(events===null){continue}var fieldType=field.type;if(fieldType=="repeat"){updatedRepeatIds.push(key)}var $field=null;if(field.isUnderRepeat){$field=r._getJQField(fieldType,key+"[1]")}else{$field=r._getJQField(fieldType,key)}if($field!=null&&typeof ajaxUpdates!=="undefined"&&ajaxUpdates!=null&&ajaxUpdates.length>0){var updated=false;if(field.isUnderRepeat){var rptId=field.repeatId;var numberOfGroups=smartletfields[rptId].numberOfGroups;for(var i=0;i<numberOfGroups;i++){$field=r._getJQField(fieldType,key+"["+(i+1)+"]");for(var j=0;j<ajaxUpdates.length;j++){if(ajaxUpdates[j].is($field[0])||$.contains(ajaxUpdates[j][0],$field[0])||$.inArray(field.repeatId,updatedRepeatIds)>-1){updated=true;break}}}}else{for(var i=0;i<ajaxUpdates.length;i++){if(ajaxUpdates[i].is($field[0])||$.contains(ajaxUpdates[i][0],$field[0])||$.inArray(field.repeatId,updatedRepeatIds)>-1){updated=true;break}}}if(!updated){continue}}for(var event in events){var jqEvent=event.toLowerCase();if(fieldType==="repeat"){if(jqEvent==="onupdateinstance"||jqEvent==="ondeleteinstance"||jqEvent==="onaddinstance"){var repeatDiv=$("div#div_"+key,r.fm);var smartlet=r._createSmartletContext(field,fieldType,key);var handler=r._createEventHandler(events[event].client);repeatDiv.data("_smartlet",smartlet).bind("repeat:"+jqEvent.substring(2),handler);continue}}if(field.isUnderRepeat){var rptId=field.repeatId;var numberOfGroups=smartletfields[rptId].numberOfGroups;for(var i=0;i<numberOfGroups;i++){var fieldHtmlName=key+"\\["+(i+1)+"\\]";if($field.attr("class")!=null&&$field.attr("class").indexOf("btn-modal")<0){r._bindFieldEvent(field,fieldType,fieldHtmlName,event,events[event].server,events[event].client,events[event]["isAjax"])}else{r._bindModalFieldEvent(field,fieldType,fieldHtmlName,event,events[event].server,events[event].client,events[event]["isAjax"])}}}else{if($field.is(":visible")||$("#div_"+key).parents(".smartmodal").length>0){if($field.attr("class")!=null&&$field.attr("class").indexOf("btn-modal")<0){r._bindFieldEvent(field,fieldType,key,event,events[event].server,events[event].client,events[event]["isAjax"])}else{r._bindModalFieldEvent(field,fieldType,key,event,events[event].server,events[event].client,events[event]["isAjax"])}}}}}$('[data-toggle="tooltip"]',r.fm).tooltip();customJS.bindEvents(r)},_createSmartletContext:function(contextField,fieldType,fieldHtmlName){var smartlet={_fieldObj:function(fieldNode,htmlName){if(!fieldNode){return null}var r=SMARTGUIDES[smartletCode];var $field;if(fieldNode.type==="staticText"||fieldNode.type==="staticImg"){$field=$("div#div_"+htmlName,r.fm)}else{if(this._fieldType==="sub-smartlet"){$field=$('[name="t_e'+htmlName.substring(2)+'"]',r.fm)}else{$field=$('[name="'+htmlName+'"]',r.fm)}}return{name:fieldNode.name,id:htmlName.substring(2).replace(/\\/g,""),htmlName:htmlName.replace(/\\/g,""),$:$field,value:$field.val()}},_fieldType:fieldType,_contextField:contextField,_fieldHtmlName:fieldHtmlName,lang:function(){return currentLang},field:function(nameOrId){if(!nameOrId){return this._fieldObj(this._contextField,this._fieldHtmlName)}if(typeof smartletfields["d_"+nameOrId]!=="undefined"){return this._fieldObj(smartletfields["d_"+nameOrId],"d_"+nameOrId)}if(typeof smartletfields["t_"+nameOrId]!=="undefined"){return this._fieldObj(smartletfields["t_"+nameOrId],"t_"+nameOrId)}for(var key in smartletfields){var f=smartletfields[key];if(f.name==nameOrId){if(f.isUnderRepeat&&this.field().htmlName.indexOf("[")>-1){var index=this.field().htmlName.substring(this.field().htmlName.indexOf("["));key=key+index}return this._fieldObj(f,key)}}return null},openModal:function(modal){var r=SMARTGUIDES[smartletCode];r.ajaxProcess(modal,null,true,function(){r.addScrollLock()});modal.modal("show")},closeModal:function(modal){var r=SMARTGUIDES[smartletCode];r.ajaxProcess(modal,null,true,function(){r.removeScrollLock()});modal.modal("hide")},validateModal:function(modalId,callback){var validationResult=true;var r=SMARTGUIDES[smartletCode];var fm=r.fm;fm.ajaxSubmit({crossDomain:false,type:"post",iframe:false,data:{g_validation:modalId},success:function(data){try{response=data;var sourceAlertDiv=$("#alerts",r.fm);var targetAlertDiv=$("#alerts",response);$(sourceAlertDiv).after(targetAlertDiv).remove();var errorMessages=$(".alert-danger",response).text().trim();if(errorMessages!==""){validationResult=false}var res=true}catch(e){if(console){console.log(e.stack)}}r.posted=false},error:function(XMLHttpRequest,textStatus,errorThrown){r.posted=false;if(console){console.log("Error: print XMLHttpRequest textStatus and errorThrown");console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown)}}});return validationResult}};return smartlet},_createEventHandler:function(clientEvent){var handler=function(e){var f=true;try{var smartlet=$(this).data("_smartlet");f=Function("smartlet","field","ajaxSubmit","submit",clientEvent).bind(smartlet.field())(smartlet,smartlet.field.bind(smartlet))}catch(err){alert(err)}if(typeof e!=="undefined"&&typeof f!=="undefined"&&f===false){e.stopImmediatePropagation();return false}};return handler},_getJQField:function(fieldType,fieldHtmlName){var r=SMARTGUIDES[smartletCode];var $field;if(fieldType==="staticText"||fieldType==="staticImg"){$field=$("div#div_"+fieldHtmlName,r.fm)}else{$field=$('[name="'+fieldHtmlName+'"]',r.fm)}return $field},_bindModalFieldEvent:function(contextField,fieldType,fieldHtmlName,event,isServer,clientEvent,isAjax){var r=SMARTGUIDES[smartletCode];var jqEvent=event.toLowerCase();if(jqEvent.indexOf("on")==0){jqEvent=jqEvent.substring(2)}var $field=r._getJQField(fieldType,fieldHtmlName);if(fieldType=="repeat"){$field=$("#div_"+fieldHtmlName)}if(isServer){$field.unbind(jqEvent);$field.bind(jqEvent,function(e){var r=SMARTGUIDES[smartletCode];$(this).after($("<input/>",{type:"hidden",name:"e_"+fieldHtmlName.substring(2).replace(/\\/g,""),value:"on"+e.type}));if(isAjax){var modalId="";r.ajaxProcess(this,null,true,function(){$('[name="e_'+fieldHtmlName.substring(2).replace(/\\/g,"")+'"]').remove();setTimeout(function(){var updated=[];$field.unbind(jqEvent);var errorMessages=$(".alert-danger",$form).text().trim();if(errorMessages==""){var smartlet=r._createSmartletContext(contextField,fieldType,fieldHtmlName);var handler=r._createEventHandler(clientEvent);$field.data("_smartlet",smartlet).bind(jqEvent,handler);$field.triggerHandler(jqEvent)}},0)})}else{if(!$(this).hasClass("always-enabled")){r._doubleClickHandler(e)}else{r.fm.submit()}if($(this).hasClass("always-enabled")){$('[name="e_'+fieldHtmlName.substring(2).replace(/\\/g,"")+'"]').remove()}}return false})}},_bindFieldEvent:function(contextField,fieldType,fieldHtmlName,event,isServer,clientEvent,isAjax){var r=SMARTGUIDES[smartletCode];var jqEvent=event.toLowerCase();if(jqEvent.indexOf("on")==0){jqEvent=jqEvent.substring(2)}var $field=r._getJQField(fieldType,fieldHtmlName);if(fieldType=="repeat"){$field=$("#div_"+fieldHtmlName)}if(typeof clientEvent!=="undefined"){$field.unbind(jqEvent);var smartlet=r._createSmartletContext(contextField,fieldType,fieldHtmlName);var handler=r._createEventHandler(clientEvent);$field.data("_smartlet",smartlet).bind(jqEvent,handler);if((jqEvent=="fieldinit"||jqEvent=="fieldrender")&&$field.is(":visible")){$field.triggerHandler(jqEvent)}}if(isServer){if(typeof clientEvent=="undefined"){$field.unbind(jqEvent)}$field.bind(jqEvent,function(e){var r=SMARTGUIDES[smartletCode];$(this).after($("<input/>",{type:"hidden",name:"e_"+fieldHtmlName.substring(2).replace(/\\/g,""),value:"on"+e.type}));if(!$(this).attr("data-eventtarget")&&$("*[data-eventtarget]",this)){$(this).attr("data-eventtarget",$("*[data-eventtarget]",this).attr("data-eventtarget"))}if(isAjax){r.ajaxProcess(this,null,true,function(){$('[name="e_'+fieldHtmlName.substring(2).replace(/\\/g,"")+'"]').remove()})}else{if(!$(this).hasClass("always-enabled")){r._doubleClickHandler(e)}else{r.fm.submit()}if($(this).hasClass("always-enabled")){$('[name="e_'+fieldHtmlName.substring(2).replace(/\\/g,"")+'"]').remove()}}return false})}},bindThis:function(){var r=SMARTGUIDES[smartletCode];r.bindAllFieldsUnderRepeat(this);r.ajaxProcess(this,null,false)},bindThisAllowSelfRefresh:function(){var r=SMARTGUIDES[smartletCode];r.bindAllFieldsUnderRepeat(this);r.ajaxProcess(this,null,true)},bindThisOption:function(){var r=SMARTGUIDES[smartletCode];r.bindAllFieldsUnderRepeat(this);r.ajaxProcess($("option",this),null,false)},bindAllFieldsUnderRepeat:function(elmt){if($(elmt).attr("id")!=null&&$(elmt).attr("id").indexOf("[")==-1){var newArr=[];var targetArr=eval($(elmt).attr("data-eventtarget"));var bReplacements=false;if(typeof targetArr!=="undefined"&&targetArr!=null){for(var i=0;i<targetArr.length;i++){var baseId=targetArr[i];if(targetArr[i].indexOf("[")>-1){baseId=targetArr[i].substring(0,targetArr[i].indexOf("["))}if(smartletfields[baseId].isUnderRepeat){var rptId=smartletfields[baseId].repeatId;var nbrGroups=smartletfields[rptId].numberOfGroups;for(var j=1;j<=nbrGroups;j++){if(!newArr.includes(baseId+"["+j+"]")){newArr.push(baseId+"["+j+"]");bReplacements=true}}}else{if(!newArr.includes(targetArr[i])){newArr.push(targetArr[i])}}}}if(bReplacements){var newDataEventTarget=newArr.join('","');$(elmt).attr("data-eventtarget",'["'+newDataEventTarget+'"]')}}},bindSelectBoxRadios:function(){var r=SMARTGUIDES[smartletCode];$("input[type=radio][data-group]").each(function(){$(this).unbind("change").bind("change",function(){var dataGroup=$(this).attr("data-group");var otable=r.dataTableInstances["div_"+dataGroup];if(typeof otable!=="undefined"){$("input[type=radio][data-group]",otable.cells().nodes()).not(this).prop("checked",false)}else{$("input[type=radio][data-group]",$("#div_"+dataGroup)).not(this).prop("checked",false)}})})},ajaxProcess:function(elmt,elmt2,allowSelfRefresh,callBack){var r=SMARTGUIDES[smartletCode];var fm=r.fm;if(!allowSelfRefresh){var targetArr=eval($(elmt).attr("data-eventtarget"));if(typeof targetArr!=="undefined"&&targetArr!=null){if(targetArr.length==1){var currentID=$(elmt).attr("id");if(targetArr[0]==currentID){return}}}}fm.ajaxSubmit({crossDomain:false,type:"post",iframe:false,data:{isAjax:"true"},success:function(data){try{response=data;var responseDiv=$("div#sgControls",response);var currentDiv=$("div#sgControls");var targetArr=eval($(elmt).attr("data-eventtarget"));var currentID=$(elmt).attr("id");var updated=[];if(typeof targetArr!=="undefined"&&targetArr!=null){for(var i=0;i<targetArr.length;i++){if(targetArr[i]=="form"){var responseTarget=responseDiv;responseTarget=responseTarget.clone();$(currentDiv).after(responseTarget).remove();break}if(allowSelfRefresh||targetArr[i]!=currentID){var targetDiv="div_"+targetArr[i];targetDiv=targetDiv.replace("[","\\[").replace("]","\\]");var responseTarget=$("#"+targetDiv,responseDiv);responseTarget=responseTarget.clone();if(responseTarget.length>0){var currentTarget=$("#"+targetDiv,currentDiv);if($(".crud-modal",responseTarget).length>0){$(".crud-modal",responseTarget).hide()}$(currentTarget).after(responseTarget).remove();updated.push(responseTarget)}}}}var modalAlertId=$("#repeat-errors-validation").attr("id");var showErrors=false;if(typeof modalAlertId==="undefined"){showErrors=true;var parentId=$(elmt).parent().attr("id");modalAlertId=$("*[id*=modalAlerts]",$("#"+parentId).closest(".smartmodal")).attr("id")}if(typeof modalAlertId!=="undefined"){if(showErrors){var sourceModalAlertDiv=$("#"+modalAlertId,fm);var targetModalAlertDiv=$("#"+modalAlertId,response);$(sourceModalAlertDiv).after(targetModalAlertDiv).remove()}else{$(".alert:not(.alert-warning)",elmt).html("").hide()}}else{var sourceAlertDiv=$("#alerts",fm);var targetAlertDiv=$("#alerts",response);$(sourceAlertDiv).after(targetAlertDiv).remove()}var sourceSGLIBDiv=$("#sglib",fm);var targetSGLIBDiv=$("#sglib",response);$(sourceSGLIBDiv).after(targetSGLIBDiv).remove();r.bindEvents(updated);if(elmt2!=null&&!(typeof elmt2==="undefined")){$(elmt2).val("")}if(callBack){callBack(updated)}}catch(e){if(console){console.log(e.stack)}}r.posted=false},error:function(XMLHttpRequest,textStatus,errorThrown){r.posted=false;if(console){console.log("Error: print XMLHttpRequest textStatus and errorThrown");console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown)}}})}};SMARTGUIDES[smartletCode].init()});